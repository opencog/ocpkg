#!/bin/bash
#
## @file		ocpkg
## @copyright		OpenCog Foundation (2012-2025)
## @author		David Hart <dhart@opencog.org>
## @section DESCRIPTION	A script to download, build, test, and install OpenCog
## @section LICENSE	Permission to copy and modify is granted under the GPL
## @section REQUIREMENT	Ubuntu Linux 22.04+ or compatible
## @section SEEALSO	Dockerfile - compile and run OpenCog in a Linux container

# This bash script is organized in sections
# SECTION 1. Global variable setting
# SECTION 2. Command line option handling
# SECTION 3. Error handling
# SECTION 4. Function definitions
# SECTION 5. Main program

# trap errors
set -e

# SECTION 1: GLOBAL VARIABLES

PATH_PREFIX=/usr/local
CURRENT_DIR=$(pwd)
SOURCE_DIR=""
BUILD_DIR=""

if [ "$USER" == "root" ] ; then
 HOST_SOURCE_BRANCH=$PATH_PREFIX/src/opencog
 HOST_BUILD_DIR=/tmp/opencog_build
else
 HOST_SOURCE_BRANCH=$CURRENT_DIR/opencog/src
 HOST_BUILD_DIR=$CURRENT_DIR/opencog/build
fi

SELF_NAME=$(basename $0)

GUILEVERSION=3.0.10

PROCESSORS=$(grep "^processor" /proc/cpuinfo | wc -l)
MAKE_JOBS=$(($PROCESSORS+0))

VERBOSE="-v"				#for mount, umount, rm, etc.
#QUIET="-qq" 				#for apt-get

REPOSITORIES=""

PACKAGES_FETCH="
		git \
		curl \
		wget \
		"

PACKAGES_ADMIN="
		apt-rdepends \
		"

# The only remaining user of boost is as-moses
# libboost-date-time-dev asmoses gregorian dates.
# libboost-program-options-dev by asmoses/utils/log_prog_name.cc
# libboost-regex-dev asmoses combo
# libboost-random-dev asmoses random shuffle
#
PACKAGES_BUILD_OLD=" \
		libboost-date-time-dev \
		libboost-math-dev \
		libboost-program-options-dev \
		libboost-regex-dev \
		libboost-random-dev \
		"

# Packages for GPU devel (OpenCL)
#   clinfo
# For AMD GPU's
#   mesa-opencl-icd opencl-headers opencl-clhpp-headers
# For Nvidia GPU's
#   cuda-opencl-dev XXX no !??
# Compiler for GPU kernels
#   clang-14 llvm-spirv-14
PACKAGES_BUILD_GPU=" \
		clinfo \
		mesa-opencl-icd \
		ocl-icd-opencl-dev \
		opencl-headers \
		opencl-clhpp-headers \
		clang-14 \
		llvm-spirv-14 \
		"

# Default apt packages that provide guile.
PACKAGES_BUILD_GUILE=" \
		guile-3.0 guile-3.0-dev \
		"

# The opencv-dev package is needed for vision processing. Unfortunately
# it sucks in vast numbers of junk packages as depdencies, including
# parts of X11, libgtk-3-common, ubuntu-mono, unixodbc-common, libtk8.6
# and more. Sidelining this one package could reduce a lot of cruft.
PACKAGES_BUILD_VISION=" \
		libopencv-dev \
		"
#
# libsparsehash-dev is optional for atomspace
# libpq-dev is needed by the postgres storage node.
# libjsoncpp-dev is needed by the cogserver.
# libasio-dev is needed by the cogserver.
# uuid-dev is used by lg-atomese and generate
#
# m4 autoconf-archive autoconf automake autopoint libtool swig flex
# are all required to build link-grammar.
#
PACKAGES_BUILD_CORE=" build-essential \
		binutils-dev \
		libiberty-dev \
		libltdl-dev \
		libasio-dev \
		libbz2-dev \
		libedit-dev \
		libjsoncpp-dev \
		libpcre2-dev \
		libpq-dev \
		libreadline-dev \
		librocksdb-dev \
		libsparsehash-dev \
		libssl-dev \
		uuid-dev \
		autoconf automake autopoint autoconf-archive \
		ccache \
		cmake \
		cxxtest \
		flex \
		m4 \
		libtool \
		locales
		swig \
		"

PACKAGES_BUILD="
		$PACKAGES_BUILD_CORE \
		$PACKAGES_BUILD_GUILE \
		"

PACKAGES_RUNTIME="
		gperf \
		less \
		netcat-openbsd \
		postgresql-client \
		vim \
		"

# SECTION 2: Command line option handling

usage() {
  echo "Usage: $SELF_NAME OPTION"
  echo " -r Add software repositories"
  echo " -d Install base/system build dependencies"
  echo " -p Install python build dependencies"
  echo " -i Install build-job artifacts"
  echo " -c Install CogUtil"
  echo " -a Install AtomSpace"
  echo " -f Install from opencog github repo. Pass the name of the repo as an argument"
  echo " -l [master|java] Install Link Grammar release tarball; else master branch"
  echo " -u Install the GPU subsystem"
  echo " -z Install the language subsystem"
  echo " -x Install the benchmarking tools"
  echo " -n Install the vision subsystem"
  echo " -m Install ASMOSES"
  echo " -o Install OpenCog (obsolete)"
  echo " -g Install Guile $GUILEVERSION from source"
  echo " -b Build source code in git worktree found @ $PWD"
  echo " -e Build examples in git worktree found @ $PWD"
  echo " -t Run tests of source code in git worktree found @ $PWD"
  echo " -j [jobs] override number of auto-detected make jobs"
  echo " -w download data for the opencog repo"
  echo " -v Verbose output for 'apt-get' commands"
  echo " -h This help message"
}

if [ $# -eq 0 ] ; then NO_ARGS=true ; fi

while getopts "abdef:gipcrstl:mhvj:ownuz" flag ; do
  case $flag in
    r)	ADD_REPOSITORIES=true ;;
    d)	INSTALL_DEPENDENCIES=true ;; # base development packages
    w)	DOWNLOAD_DATA=true ;;
    p)	INSTALL_OPENCOG_PYTHON_PACKAGES=true ;;
    c)	INSTALL_COGUTIL=true ;;
    a)	INSTALL_ATOMSPACE=true ;;
    f)	INSTALL_FROM_REPO="$OPTARG" ;;
    o)	INSTALL_OPENCOG=true ;;
    l)	INSTALL_LINK_GRAMMAR=true ;
      	if [ "$OPTARG" == "master" ]; then
      	  INSTALL_LG_MASTER=true
      	elif [ "$OPTARG" == "java" ]; then
      	  INSTALL_JAVA_LINK_GRAMMAR=true
      	fi ;;
    u)	INSTALL_GPU_SUBSYS=true ;;
    z)	INSTALL_LANGUAGE=true ;;
    x)	INSTALL_BENCHMARK=true ;;
    n)	INSTALL_VISION=true ;;
    m)	INSTALL_ASMOSES=true ;;
    g)	INSTALL_GUILE=true ;;
    b)	BUILD_SOURCE=true ;;
    e)	BUILD_EXAMPLES=true ;;
    t)	TEST_SOURCE=true ;;
    v)	unset QUIET ;;
    j)	MAKE_JOBS="$OPTARG" ;;
    i)	INSTALL_BUILD=true ;;
    h)	usage ;;
    \?)	usage; exit 1 ;;
    *)  UNKNOWN_FLAGS=true ;;
  esac
done

shift $((OPTIND-1))

message() {
echo -e "\e[1;34m[$SELF_NAME] $MESSAGE\e[0m"
}

# SECTION 3: Function Definitions

is_x68_64() {
ARCH=$(uname -m);
if [ "$ARCH" == "x86_64" ]; then
  return 0
else
  return 1
fi
}

get_release_version() {
  cat /etc/os-release | grep "^VERSION_CODENAME="  | cut -d "=" -f 2
}

RELEASE_VERSION=$(get_release_version)

add_repositories() {
MESSAGE="Adding software repositories..." ; message
for REPO in $REPOSITORIES ; do
  sudo apt-add-repository -y $REPO
done

sudo apt-get $QUIET --assume-yes update
}

get_github_latest_release() {
  local _user="$1"
  local _repo="$2"
  local _file_name="$3"

  # Getting the version and also accepting the file-name means that the
  # download will fail if the release is updated and the file-name has a
  # reference to the previous release, a hacky annoying reminder. If the
  # file-name has no reference to the version then all will go well.
  # TODO: Handle failure gracefully.
  local _version=$(curl https://github.com/"$_user"/"$_repo"/releases/latest \
    | cut -d "\"" -f 2 | cut -d "/" -f 8)
  echo $_user $_repo $_version
  rm -f $_file_name
  wget https://github.com/"$_user"/"$_repo"/releases/download/"$_version"/"$_file_name"
}

install_admin() {
MESSAGE="Installing sysadmin tools...." ; message
if ! sudo apt-get $QUIET --no-upgrade --assume-yes install $PACKAGES_ADMIN ; then
  MESSAGE="Please enable 'universe' repositories and re-run this script."  ; message
  exit 1
fi
}

# Install given opencog github repo
install_opencog_github_repo() {
  local REPO="$1"
  MESSAGE="Installing ${REPO}...." ; message
  cd /tmp/
  # cleaning up remnants from previous install failures, if any.
  rm -rf master.tar.gz* ${REPO}-master
  rm -rf master.tar.gz* ${REPO}-main
  wget https://github.com/opencog/${REPO}/archive/master.tar.gz
  tar -xvf master.tar.gz

  # Newer git repos call them `main` not `master`, cause #RacialJustice
  if [ -d ${REPO}-master/ ]
  then
      cd ${REPO}-master/
  fi
  if [ -d ${REPO}-main/ ]
  then
      cd ${REPO}-main/
  fi

  mkdir build
  cd build/
  cmake ..
  make -j$(nproc)
  sudo make install
  sudo ldconfig
  cd /tmp/
  rm -rf master.tar.gz ${REPO}-master/
  rm -rf master.tar.gz ${REPO}-main/
  cd $CURRENT_DIR
}

# Install cogutil
install_cogutil() {
  install_opencog_github_repo cogutil
}

# Install additional Python packages
# Except that there aren't any at this time....
install_opencog_python_packages() {
  MESSAGE="Installing base python packages...." ; message
  install_python
}

# The following sets the source & build directory for a project
set_source_and_build_dir() {
if [ "$(git rev-parse --is-inside-work-tree)" == true ] ; then
    SOURCE_DIR=$(git rev-parse --show-toplevel)
    MESSAGE="Source Directory is set to $SOURCE_DIR" ; message
    if [ -d $SOURCE_DIR/build ]; then
        BUILD_DIR=$SOURCE_DIR/build
        MESSAGE="Build Directory is set to $SOURCE_DIR/build" ; message
    else
        mkdir $SOURCE_DIR/build
        BUILD_DIR=$SOURCE_DIR/build
        MESSAGE="Build Directory is set to $SOURCE_DIR/build" ; message
    fi
else
    MESSAGE="Exiting $SELF_NAME as git worktree is not detected run inside \
a git worktree" ; message
    exit 1
fi
}

# Build function for cogutil, atomspace & asmoses repos
build_source() {
  set_source_and_build_dir
  if [ -a $BUILD_DIR/CMakeCache.txt ]; then
      rm $BUILD_DIR/CMakeCache.txt
      MESSAGE="Removed cmake cache file: rm $BUILD_DIR/CMakeCache.txt" ; message
  fi
  MESSAGE="cmake -B$BUILD_DIR -H$SOURCE_DIR" ; message
  #stackoverflow.com/questions/20610255/how-to-tell-cmake-where-to-put-build-files
  cmake -B$BUILD_DIR -H$SOURCE_DIR
  MESSAGE="make -C $BUILD_DIR -j$MAKE_JOBS" ; message
  make -C $BUILD_DIR -j$MAKE_JOBS
  MESSAGE="Finished building source" ; message
}

# Build examples function for atomspace & asmoses repos
build_examples() {
  set_source_and_build_dir
  if [ -a $BUILD_DIR/CMakeCache.txt ]; then
      rm $BUILD_DIR/CMakeCache.txt
      MESSAGE="Removed cmake cache file: rm $BUILD_DIR/CMakeCache.txt" ; message
  fi
  MESSAGE="cmake -B$BUILD_DIR -H$SOURCE_DIR" ; message
  #stackoverflow.com/questions/20610255/how-to-tell-cmake-where-to-put-build-files
  cmake -B$BUILD_DIR -H$SOURCE_DIR
  MESSAGE="make -C $BUILD_DIR  -j$MAKE_JOBS examples" ; message
  make -C $BUILD_DIR -j$MAKE_JOBS examples
  MESSAGE="Finished building examples" ; message
}

# Run tests function for cogutil, atomspace & asmoses repos
test_source() {
  set_source_and_build_dir
  if [ -a $BUILD_DIR/CMakeCache.txt ]; then
      rm $BUILD_DIR/CMakeCache.txt
      MESSAGE="Removed cmake cache file: rm $BUILD_DIR/CMakeCache.txt" ; message
  fi
  MESSAGE="cmake -B$BUILD_DIR -H$SOURCE_DIR" ; message
  #stackoverflow.com/questions/20610255/how-to-tell-cmake-where-to-put-build-files
  cmake -B$BUILD_DIR -H$SOURCE_DIR
  MESSAGE="make -C $BUILD_DIR -j$MAKE_JOBS test" ; message
  make -C $BUILD_DIR -j$MAKE_JOBS test #ARGS=-j$MAKE_JOBS
  MESSAGE="Finished building & running tests" ; message
}

# Install build job artifacts
install_build() {
  set_source_and_build_dir
  MESSAGE="Starting installation" ; message
  cd $BUILD_DIR
  sudo make install
  sudo ldconfig
  cd $CURRENT_DIR
  MESSAGE="Finished installation" ; message
}

# Install Core AtomSpace
install_atomspace(){
  install_opencog_github_repo atomspace
  install_opencog_github_repo atomspace-storage
  install_opencog_github_repo atomspace-rocks
  install_opencog_github_repo cogserver
  install_opencog_github_repo atomspace-cog
  install_opencog_github_repo unify
  install_opencog_github_repo sensory
  install_opencog_github_repo motor

  # Postgres no longer builds due to missing SimpleTV and general
  # obsolescence.
  # install_opencog_github_repo atomspace-pgres
}

# Install Language components
# This requires a re-install of Link Grammar, after the AtomSpace
# and after lg-atomese have been installed, because Link Grammar
# now uses the AtomSpace to hold dictionaries, and the lg-atomese
# Atom types to do it.
install_language() {
  install_link_grammar
  install_opencog_github_repo lg-atomese
  install_link_grammar
  install_opencog_github_repo matrix
  install_opencog_github_repo learn
  install_opencog_github_repo generate
}

# Install GPU stuff
install_gpu_subsys() {

  sudo apt-get $QUIET --no-upgrade --assume-yes install $PACKAGES_BUILD_GPU
  install_opencog_github_repo atomese-simd
}

# Install vision stuff This installs 250 more apt packages!!
install_vision() {
  sudo apt-get $QUIET --no-upgrade --assume-yes install $PACKAGES_BUILD_VISION
  install_opencog_github_repo vision
}

# Install benchmarking subset
# agi-bio does nothing but provide some atom types for benchmarking.
install_benchmark() {
  install_opencog_github_repo agi-bio
  install_opencog_github_repo benchmark
}

# Install obsolete parts of OpenCog
# None of these compile any longer due to bitrot.
install_opencog() {
  install_opencog_github_repo ure
  install_opencog_github_repo attention
  install_opencog_github_repo spacetime
  install_opencog_github_repo pln
  install_opencog_github_repo miner
  install_opencog_github_repo opencog
}

# Install ASMOSES
install_asmoses() {
  sudo apt-get $QUIET --no-upgrade --assume-yes install $PACKAGES_BUILD_OLD
  install_opencog_github_repo asmoses
}

# Install Link-Grammar
install_link_grammar(){
  # This uses the archive created by github to build and install link-grammar
  # The release at https://www.abisource.com/downloads/link-grammar isn't used
  # because the only additional value it provides is it gives a pre configured
  # tar ball, and its tls certificate breaks often. Such tar-bar can be released
  # by following instructions at
  # https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository#creating-a-release
  MESSAGE="Installing Link-Grammar...." ; message
  cd /tmp/

  # cleaning up remnants from previous install failures, if any.
  rm -rf link-grammar*
  rm -rf master.tar.gz

  # Get install version from command line
  if [ $# -eq 1 ]; then
    local _version=${1}
    wget https://github.com/opencog/link-grammar/archive/link-grammar-${_version}.tar.gz
    tar -zxf link-grammar-${_version}.tar.gz
    cd link-grammar-link-grammar-${_version}/

  elif [ $INSTALL_LG_MASTER ]; then

    # Master version fails to follow naming convention
    local _version="master"
    wget https://github.com/opencog/link-grammar/archive/master.tar.gz
    tar -zxf master.tar.gz
    cd link-grammar-${_version}/
  else

    # Hunt down the latest tarball version. Abisource is dead.
    # local _version=$(wget -O - http://www.abisource.com/downloads/link-grammar/current/ \
    #  | grep md5 | awk 'match($0, /[5-9]\.[0-9]+\.[0-9]+/) {print substr($0, RSTART, RLENGTH)}')
    local _version=$(git ls-remote -t \
        https://github.com/opencog/link-grammar "link-grammar-5*" \
        | grep -v "\^"| cut -d "-" -f 3 | sort -V |tail -n 1 )
    wget https://github.com/opencog/link-grammar/archive/link-grammar-${_version}.tar.gz
    tar -zxf link-grammar-${_version}.tar.gz
    cd link-grammar-link-grammar-${_version}/
  fi
  ./autogen.sh --no-configure
  mkdir build
  cd build
  if [ $INSTALL_JAVA_LINK_GRAMMAR ]; then
    ../configure
  else
    ../configure --disable-java-bindings
  fi
  make -j$(nproc)
  sudo make install
  sudo ldconfig
  cd /tmp/
  rm -rf link-grammar*
  rm -rf master.tar.gz
  cd $CURRENT_DIR
}

install_bdwgc() {
  MESSAGE="Installing latest bdwgc ...." ; message
  # This used to work, but not any longer...!?
  # Apparently, the newest versions of curl behave differently!?
  # local _version=$(curl https://github.com/ivmai/bdwgc/releases/latest \
  #    | cut -d "\"" -f 2 | cut -d "/" -f 8)
  local _version=$(curl --silent -w %{redirect_url} https://github.com/bdwgc/bdwgc/releases/latest \
      | cut -d "\"" -f 2 | cut -d "/" -f 8)

  local _dir_name="gc-${_version:1}"

  # Apparently, the github download URL's have changed.
  local _file_name="${_dir_name}.tar.gz"
  local _download_name="${_version}/${_dir_name}.tar.gz"

  cd /tmp/
  rm -rf ${_dir_name}*
  get_github_latest_release ivmai bdwgc ${_download_name}
  tar -xvf ${_file_name}
  cd ${_dir_name}
  ./configure --enable-large-config
  make -j$(nproc)
  sudo make install
  sudo ldconfig
  cd /tmp/
  rm -rf ${_dir_name}*
}

install_python() {
  MESSAGE="Installing python3 ...." ; message
  sudo apt-get install -y --no-install-recommends python3-dev

  # Ubuntu focal is 20.04 LTS
  if [[ $RELEASE_VERSION = "focal" ]]; then
    sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.8 2
  fi
  sudo apt-get install -y --no-install-recommends python3-pytest cython3
}

# Install pip seperately. The problem here is that installing pip
# breaks python in ways that I cannot figure out. So punt, until some
# python guru shows up and fixes this stuff.
install_python_pip() {
  MESSAGE="Installing python3 pip...." ; message
  sudo apt-get install -y --no-install-recommends python3-pip
  sudo pip3 install -U pip setuptools
}


install_guile() {
    # First, remove the default guile.
    sudo apt-get --assume-yes purge $PACKAGES_BUILD_GUILE --auto-remove

    # Next, install things that the bdwgc/guile build will need.
    sudo apt-get install -y --no-install-recommends \
      libatomic-ops-dev libgmp-dev libffi-dev libunistring-dev

    install_bdwgc
    MESSAGE="Installing guile-$GUILEVERSION...." ; message
    cd /tmp/
    # Clean up remnants from previous install failures, if any.
    rm -rf guile-${GUILEVERSION}*
    wget https://ftp.gnu.org/gnu/guile/guile-$GUILEVERSION.tar.gz
    tar -xvf guile-$GUILEVERSION.tar.gz
    cd guile-$GUILEVERSION
    mkdir build
    cd build
    ../configure
    make -j$(nproc)
    sudo make install
    sudo mv  /usr/local/lib/libguile-*.so.*-gdb.scm /usr/share/gdb/auto-load/
    sudo ldconfig
    cd /tmp/
    rm -rf guile-${GUILEVERSION}*
}

# atomspace unit tests have UTF-8 test cases
# link-grammar needs a smattering of locales
ensure_UTF_installed() {
    if locale -a | grep -q en_US.utf8
    then
        echo UTF-8 locale enabled already
    else
        sudo sh -c 'echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "ar_AE.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "de_DE.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "fa_IR.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "fr_FR.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "he_IL.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "id_ID.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "kk_KZ.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "lt_LT.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "ru_RU.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "th_TH.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "tr_TR.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "vi_VN.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "zh_CN.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo sh -c 'echo "zh_HK.UTF-8 UTF-8" >> /etc/locale.gen'
        sudo locale-gen
    fi
}

# Install system dependencies
install_dependencies() {
  # Install the latest python3 version before everything else
  install_python

  MESSAGE="Installing OpenCog build dependencies...." ; message
  if ! sudo apt-get $QUIET --no-upgrade --assume-yes --no-install-recommends install $PACKAGES_BUILD $PACKAGES_RUNTIME $PACKAGES_FETCH ; then
    exit 1
  fi
  ensure_UTF_installed

  # gcc-11 is needed in NumberNode.h for std::lexical cast,
  # also for std::atomic::wait()
  # Ubuntu focal is 20.04 LTS
  # Debian bullseye is from August 2021; it uses gcc-10;
  # there no gcc-11 so it's dead meat.
  if [[ $RELEASE_VERSION = "focal" ]]; then
    sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
    sudo apt-get $QUIET --assume-yes --no-install-recommends install gcc-11 g++-11
    sudo apt purge --yes gcc-9
    sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-11 110 \
      --slave /usr/bin/g++ g++ /usr/bin/g++-11 \
      --slave /usr/bin/gcov gcov /usr/bin/gcov-11
    sudo update-ccache-symlinks
  fi

  # Install custom guile >3.0.0 for language-learning
  # Not needed -- the apt-get default is OK these days.
  # install_guile
}

# Download data
download_data() {
  DOWNLOAD_DIR="$HOME/.opencog/data"
  MESSAGE="Downloading OpenCog's datasets to $DOWNLOAD_DIR ...." ; message
  if [ ! -d "$DOWNLOAD_DIR" ]; then
    mkdir -p "$DOWNLOAD_DIR"
  fi

  if [ ! -f "$DOWNLOAD_DIR/gtwc-en-333333-words.scm" ]; then
    wget -O "$DOWNLOAD_DIR/gtwc-en-333333-words.scm" \
      https://raw.githubusercontent.com/opencog/test-datasets/master/concept_nodes/gtwc-en-333333-words.scm
  fi
}

# SECTION 4: Main Program

if [ $UNKNOWN_FLAGS ] ; then usage; exit 1 ; fi
if [ $NO_ARGS ] ; then usage; exit 1 ; fi
if [ $ADD_REPOSITORIES ] ; then add_repositories ; fi
if [ $INSTALL_DEPENDENCIES ] ; then install_dependencies ; fi
if [ $DOWNLOAD_DATA ] ; then download_data ; fi
if [ $INSTALL_OPENCOG_PYTHON_PACKAGES ] ; then install_opencog_python_packages ; fi
if [ $INSTALL_COGUTIL ] ; then install_cogutil ; fi
if [ $INSTALL_ATOMSPACE ] ; then install_atomspace ; fi
if [ $INSTALL_LINK_GRAMMAR ] ; then install_link_grammar ; fi
if [ $INSTALL_LANGUAGE ] ; then install_language ; fi
if [ $INSTALL_GPU_SUBSYS ] ; then install_gpu_subsys ; fi
if [ $INSTALL_BENCHMARK ] ; then install_benchmark ; fi
if [ $INSTALL_VISION ] ; then install_vision ; fi
if [ $INSTALL_FROM_REPO ] ; then install_opencog_github_repo "$INSTALL_FROM_REPO" ; fi
if [ $INSTALL_OPENCOG ] ; then install_opencog ; fi
if [ $INSTALL_ASMOSES ] ; then install_asmoses ; fi
if [ $INSTALL_GUILE ] ; then install_guile ; fi
if [ $BUILD_SOURCE ] ; then build_source ; fi
if [ $BUILD_EXAMPLES ] ; then build_examples ; fi
if [ $TEST_SOURCE ] ; then test_source ; fi
if [ $INSTALL_BUILD ] ; then install_build ; fi
